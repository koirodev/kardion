
/*
 * Kordion 2.0.2.2
 * https://github.com/koirodev/kordion
 *
 * Copyright 2024 Vitaly Koiro
 *
 * Released under the MIT License
 *
 * Released on: November 08, 2024
*/
class Kordion{constructor(t,e={}){if(!t)return void console.error("No kordion selector provided!");this.settings={content:"[data-kordion-content]",hidden:"[data-kordion-hidden]",current:"[data-kordion-current]",icon:"[data-kordion-icon]",notClose:"[data-kordion-not-close]",container:["[data-kordion-container]",".section"],activeClass:"js-kordion-active",iconClass:".icon",speed:350,iconPath:"/sprite.svg#",scrollTo:!1,...e},this.kordion=t,this.initKordions()}initKordions(){const t=document.querySelectorAll(this.kordion);t.length&&t.forEach((t=>{const e=this.createKordionInstance(t);350!=this.settings.speed&&t.style.setProperty("--kordion-speed",this.settings.speed/1e3+"s"),e.current.addEventListener("click",(()=>{this.handleKordionClick(e,t)})),t.classList.contains(this.settings.activeClass)&&e.show()}))}createKordionInstance(t){const e={kordion:t,hidden:t.querySelector(this.settings.hidden),content:t.querySelector(this.settings.content),current:t.querySelector(this.settings.current),kordionIcon:null,iconHidden:null,iconShow:null};if(e.current.querySelector(this.settings.icon)){e.kordionIcon=e.current.querySelector(this.settings.icon);let t=e.kordionIcon.getAttribute(this.settings.icon.match(/\[([^\]]+)\]/)[1]);t=t.substring(1,t.length-1);const i=t.split(",");2===i.length?(e.iconHidden=i[0].trim(),e.iconShow=i[1].trim()):console.error("Invalid data-kordion-icon attribute"),e.kordionIcon.addEventListener("click",(t=>{t.preventDefault()}))}return e}handleKordionClick(t,e){if(t.current.closest(this.settings.content)){const i=t.current.closest(this.settings.hidden);return void(e.classList.contains(this.settings.activeClass)?(this.hideKordion(t),i.style.height=i.clientHeight-t.content.clientHeight+"px"):(this.showKordion(t),i.style.height=`${i.clientHeight+t.content.clientHeight}px`))}if(t.current.closest(this.settings.notClose))return void this.toggleKordion(t);const i=this.settings.container.find((e=>t.current.closest(e)));i&&this.hideAllKordions(t.current.closest(i)),this.toggleKordion(t),this.hideNestedKordions(e)}showKordion(t){t.hidden.style.height=`${t.content.clientHeight}px`,t.kordion.classList.add(this.settings.activeClass),this.settings.scrollTo&&t.content.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),setTimeout((()=>{this.replaceIcon(t,!1)}),this.settings.speed/2)}hideKordion(t){t.hidden.style.removeProperty("height"),t.kordion.classList.remove(this.settings.activeClass),setTimeout((()=>{this.replaceIcon(t,!0)}),this.settings.speed/2)}toggleKordion(t){!t.kordion.classList.contains(this.settings.activeClass)&&this.settings.scrollTo&&t.content.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),t.kordion.classList.contains(this.settings.activeClass)?this.hideKordion(t):this.showKordion(t),ScrollTrigger&&setTimeout((()=>{ScrollTrigger.refresh()}),this.settings.speed)}replaceIcon(t,e=!0){if(!t.kordionIcon)return;const i=t.kordionIcon.querySelector("use");if(!i)return void console.debug("No use tag found in the kordion icon");const o=e?t.iconHidden:t.iconShow;i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.settings.iconPath+o)}hideAllKordions(t){t.querySelectorAll(`${this.kordion}.${this.settings.activeClass}`).forEach((t=>{if(t!==event.target.closest(this.kordion)){const e=this.createKordionInstance(t);this.hideKordion(e)}}))}hideNestedKordions(t){t.querySelectorAll(this.kordion).forEach((t=>{const e=this.createKordionInstance(t);this.hideKordion(e)}))}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIktvcmRpb24iLCJjb25zdHJ1Y3RvciIsImtvcmRpb24iLCJvcHRpb25zIiwiY29uc29sZSIsImVycm9yIiwidGhpcyIsInNldHRpbmdzIiwiY29udGVudCIsImhpZGRlbiIsImN1cnJlbnQiLCJpY29uIiwibm90Q2xvc2UiLCJjb250YWluZXIiLCJhY3RpdmVDbGFzcyIsImljb25DbGFzcyIsInNwZWVkIiwiaWNvblBhdGgiLCJzY3JvbGxUbyIsImluaXRLb3JkaW9ucyIsImtvcmRpb25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJrb3JkaW9uSW5zdGFuY2UiLCJjcmVhdGVLb3JkaW9uSW5zdGFuY2UiLCJzdHlsZSIsInNldFByb3BlcnR5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUtvcmRpb25DbGljayIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwic2hvdyIsInF1ZXJ5U2VsZWN0b3IiLCJrb3JkaW9uSWNvbiIsImljb25IaWRkZW4iLCJpY29uU2hvdyIsImljb25MaXN0IiwiZ2V0QXR0cmlidXRlIiwibWF0Y2giLCJzdWJzdHJpbmciLCJpY29uQXJyYXkiLCJzcGxpdCIsInRyaW0iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiY2xvc2VzdCIsInBhcmVudENvbnRlbnQiLCJoaWRlS29yZGlvbiIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNob3dLb3JkaW9uIiwidG9nZ2xlS29yZGlvbiIsImNvbnRhaW5lckVsZW1lbnQiLCJmaW5kIiwic2VsZWN0b3IiLCJoaWRlQWxsS29yZGlvbnMiLCJoaWRlTmVzdGVkS29yZGlvbnMiLCJhZGQiLCJzY3JvbGxJbnRvVmlldyIsImJlaGF2aW9yIiwiYmxvY2siLCJpbmxpbmUiLCJzZXRUaW1lb3V0IiwicmVwbGFjZUljb24iLCJyZW1vdmVQcm9wZXJ0eSIsInJlbW92ZSIsIlNjcm9sbFRyaWdnZXIiLCJyZWZyZXNoIiwidXNlVGFnIiwiZGVidWciLCJzZXRBdHRyaWJ1dGVOUyIsImNsb3Nlc3RPYmplY3QiLCJhY3RpdmVLb3JkaW9uIiwidGFyZ2V0IiwibmVzdGVkS29yZGlvbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBQUEsUUFDQSxXQUFBQyxDQUFBQyxFQUFBQyxFQUFBLENBQUEsR0FDQSxJQUFBRCxFQUVBLFlBREFFLFFBQUFDLE1BQUEsaUNBbUJBQyxLQUFBQyxTQUFBLENBYkFDLFFBQUEseUJBQ0FDLE9BQUEsd0JBQ0FDLFFBQUEseUJBQ0FDLEtBQUEsc0JBQ0FDLFNBQUEsMkJBQ0FDLFVBQUEsQ0FBQSwyQkFBQSxZQUNBQyxZQUFBLG9CQUNBQyxVQUFBLFFBQ0FDLE1BQUEsSUFDQUMsU0FBQSxlQUNBQyxVQUFBLEtBR0FmLEdBQ0FHLEtBQUFKLFFBQUFBLEVBR0FJLEtBQUFhLGNBQ0EsQ0FFQSxZQUFBQSxHQUNBLE1BQUFDLEVBQUFDLFNBQUFDLGlCQUFBaEIsS0FBQUosU0FDQWtCLEVBQUFHLFFBRUFILEVBQUFJLFNBQUFDLElBQ0EsTUFBQUMsRUFBQXBCLEtBQUFxQixzQkFBQUYsR0FFQSxLQUFBbkIsS0FBQUMsU0FBQVMsT0FDQVMsRUFBQUcsTUFBQUMsWUFBQSxrQkFBQXZCLEtBQUFDLFNBQUFTLE1BQUEsSUFBQSxLQUdBVSxFQUFBaEIsUUFBQW9CLGlCQUFBLFNBQUEsS0FDQXhCLEtBQUF5QixtQkFBQUwsRUFBQUQsRUFBQSxJQUdBQSxFQUFBTyxVQUFBQyxTQUFBM0IsS0FBQUMsU0FBQU8sY0FDQVksRUFBQVEsTUFDQSxHQUVBLENBR0EscUJBQUFQLENBQUFGLEdBQ0EsTUFBQUMsRUFBQSxDQUNBeEIsUUFBQXVCLEVBQ0FoQixPQUFBZ0IsRUFBQVUsY0FBQTdCLEtBQUFDLFNBQUFFLFFBQ0FELFFBQUFpQixFQUFBVSxjQUFBN0IsS0FBQUMsU0FBQUMsU0FDQUUsUUFBQWUsRUFBQVUsY0FBQTdCLEtBQUFDLFNBQUFHLFNBQ0EwQixZQUFBLEtBQ0FDLFdBQUEsS0FDQUMsU0FBQSxNQUlB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LFlBREFuRSxRQUFBb0UsTUFBQSx3Q0FJQSxNQUFBN0QsRUFBQUYsRUFBQWlCLEVBQUFXLFdBQUFYLEVBQUFZLFNBQ0FpQyxFQUFBRSxlQUFBLCtCQUFBLGFBQUFuRSxLQUFBQyxTQUFBVSxTQUFBTixFQUNBLENBR0EsZUFBQStDLENBQUFnQixHQUNBQSxFQUFBcEQsaUJBQUEsR0FBQWhCLEtBQUFKLFdBQUFJLEtBQUFDLFNBQUFPLGVBQUFVLFNBQUFtRCxJQUNBLEdBQUFBLElBQUE3QixNQUFBOEIsT0FBQTVCLFFBQUExQyxLQUFBSixTQUFBLENBQ0EsTUFBQXdCLEVBQUFwQixLQUFBcUIsc0JBQUFnRCxHQUNBckUsS0FBQTRDLFlBQUF4QixFQUNBLElBRUEsQ0FHQSxrQkFBQWlDLENBQUE5QyxHQUNBQSxFQUFBUyxpQkFBQWhCLEtBQUFKLFNBQUFzQixTQUFBQyxJQUNBLE1BQUFvRCxFQUFBdkUsS0FBQXFCLHNCQUFBRixHQUNBbkIsS0FBQTRDLFlBQUEyQixFQUFBLEdBRUEiLCJmaWxlIjoia29yZGlvbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBLb3JkaW9uIHtcbiAgY29uc3RydWN0b3Ioa29yZGlvbiwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCFrb3JkaW9uKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTm8ga29yZGlvbiBzZWxlY3RvciBwcm92aWRlZCFcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBhY2NvcmRpb24gc2V0dGluZ3NcbiAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgIGNvbnRlbnQ6IFwiW2RhdGEta29yZGlvbi1jb250ZW50XVwiLFxuICAgICAgaGlkZGVuOiBcIltkYXRhLWtvcmRpb24taGlkZGVuXVwiLFxuICAgICAgY3VycmVudDogXCJbZGF0YS1rb3JkaW9uLWN1cnJlbnRdXCIsXG4gICAgICBpY29uOiBcIltkYXRhLWtvcmRpb24taWNvbl1cIixcbiAgICAgIG5vdENsb3NlOiBcIltkYXRhLWtvcmRpb24tbm90LWNsb3NlXVwiLFxuICAgICAgY29udGFpbmVyOiBbXCJbZGF0YS1rb3JkaW9uLWNvbnRhaW5lcl1cIiwgXCIuc2VjdGlvblwiXSxcbiAgICAgIGFjdGl2ZUNsYXNzOiBcImpzLWtvcmRpb24tYWN0aXZlXCIsXG4gICAgICBpY29uQ2xhc3M6IFwiLmljb25cIixcbiAgICAgIHNwZWVkOiAzNTAsXG4gICAgICBpY29uUGF0aDogXCIvc3ByaXRlLnN2ZyNcIixcbiAgICAgIHNjcm9sbFRvOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgdGhpcy5zZXR0aW5ncyA9IHsgLi4uZGVmYXVsdE9wdGlvbnMsIC4uLm9wdGlvbnMgfTtcbiAgICB0aGlzLmtvcmRpb24gPSBrb3JkaW9uO1xuXG4gICAgLy8gSW5pdGlhbGl6aW5nIEFjY29yZGlvbnNcbiAgICB0aGlzLmluaXRLb3JkaW9ucygpO1xuICB9XG5cbiAgaW5pdEtvcmRpb25zKCkge1xuICAgIGNvbnN0IGtvcmRpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLmtvcmRpb24pO1xuICAgIGlmICgha29yZGlvbnMubGVuZ3RoKSByZXR1cm47XG5cbiAgICBrb3JkaW9ucy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb25zdCBrb3JkaW9uSW5zdGFuY2UgPSB0aGlzLmNyZWF0ZUtvcmRpb25JbnN0YW5jZShlbGVtZW50KTtcblxuICAgICAgaWYgKHRoaXMuc2V0dGluZ3Muc3BlZWQgIT0gMzUwKSB7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoXCItLWtvcmRpb24tc3BlZWRcIiwgYCR7dGhpcy5zZXR0aW5ncy5zcGVlZCAvIDEwMDB9c2ApO1xuICAgICAgfVxuXG4gICAgICBrb3JkaW9uSW5zdGFuY2UuY3VycmVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZUtvcmRpb25DbGljayhrb3JkaW9uSW5zdGFuY2UsIGVsZW1lbnQpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyh0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzKSkge1xuICAgICAgICBrb3JkaW9uSW5zdGFuY2Uuc2hvdygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gQ3JlYXRpbmcgYW4gQWNjb3JkaW9uIEluc3RhbmNlXG4gIGNyZWF0ZUtvcmRpb25JbnN0YW5jZShlbGVtZW50KSB7XG4gICAgY29uc3Qga29yZGlvbkluc3RhbmNlID0ge1xuICAgICAga29yZGlvbjogZWxlbWVudCxcbiAgICAgIGhpZGRlbjogZWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuc2V0dGluZ3MuaGlkZGVuKSxcbiAgICAgIGNvbnRlbnQ6IGVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLmNvbnRlbnQpLFxuICAgICAgY3VycmVudDogZWxlbWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuc2V0dGluZ3MuY3VycmVudCksXG4gICAgICBrb3JkaW9uSWNvbjogbnVsbCxcbiAgICAgIGljb25IaWRkZW46IG51bGwsXG4gICAgICBpY29uU2hvdzogbnVsbFxuICAgIH07XG5cbiAgICAvLyBTZXR0aW5nIHVwIHRoZSBpY29uIGlmIHByZXNlbnRcbiAgICBpZiAoa29yZGlvbkluc3RhbmNlLmN1cnJlbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLmljb24pKSB7XG4gICAgICBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbkljb24gPSBrb3JkaW9uSW5zdGFuY2UuY3VycmVudC5xdWVyeVNlbGVjdG9yKHRoaXMuc2V0dGluZ3MuaWNvbik7XG4gICAgICBsZXQgaWNvbkxpc3QgPSBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbkljb24uZ2V0QXR0cmlidXRlKHRoaXMuc2V0dGluZ3MuaWNvbi5tYXRjaCgvXFxbKFteXFxdXSspXFxdLylbMV0pO1xuICAgICAgaWNvbkxpc3QgPSBpY29uTGlzdC5zdWJzdHJpbmcoMSwgaWNvbkxpc3QubGVuZ3RoIC0gMSk7XG4gICAgICBjb25zdCBpY29uQXJyYXkgPSBpY29uTGlzdC5zcGxpdChcIixcIik7XG4gICAgICBpZiAoaWNvbkFycmF5Lmxlbmd0aCA9PT0gMikge1xuICAgICAgICBrb3JkaW9uSW5zdGFuY2UuaWNvbkhpZGRlbiA9IGljb25BcnJheVswXS50cmltKCk7XG4gICAgICAgIGtvcmRpb25JbnN0YW5jZS5pY29uU2hvdyA9IGljb25BcnJheVsxXS50cmltKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCBkYXRhLWtvcmRpb24taWNvbiBhdHRyaWJ1dGVcIik7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbmNlbCBkZWZhdWx0IGFjdGlvbiB3aGVuIGNsaWNraW5nIG9uIGljb25cbiAgICAgIGtvcmRpb25JbnN0YW5jZS5rb3JkaW9uSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGtvcmRpb25JbnN0YW5jZTtcbiAgfVxuXG4gIC8vIEhhbmRsaW5nIGEgY2xpY2sgb24gYW4gYWNjb3JkaW9uXG4gIGhhbmRsZUtvcmRpb25DbGljayhrb3JkaW9uSW5zdGFuY2UsIGVsZW1lbnQpIHtcbiAgICBpZiAoa29yZGlvbkluc3RhbmNlLmN1cnJlbnQuY2xvc2VzdCh0aGlzLnNldHRpbmdzLmNvbnRlbnQpKSB7XG4gICAgICBjb25zdCBwYXJlbnRDb250ZW50ID0ga29yZGlvbkluc3RhbmNlLmN1cnJlbnQuY2xvc2VzdCh0aGlzLnNldHRpbmdzLmhpZGRlbik7XG4gICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnModGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzcykpIHtcbiAgICAgICAgdGhpcy5oaWRlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpO1xuICAgICAgICBwYXJlbnRDb250ZW50LnN0eWxlLmhlaWdodCA9IGAke3BhcmVudENvbnRlbnQuY2xpZW50SGVpZ2h0IC0ga29yZGlvbkluc3RhbmNlLmNvbnRlbnQuY2xpZW50SGVpZ2h0fXB4YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2hvd0tvcmRpb24oa29yZGlvbkluc3RhbmNlKTtcbiAgICAgICAgcGFyZW50Q29udGVudC5zdHlsZS5oZWlnaHQgPSBgJHtwYXJlbnRDb250ZW50LmNsaWVudEhlaWdodCArIGtvcmRpb25JbnN0YW5jZS5jb250ZW50LmNsaWVudEhlaWdodH1weGA7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGFjY29yZGlvbiBkb2VzIG5vdCBjbG9zZSB3aGVuIGNsaWNraW5nIG9uIGNlcnRhaW4gZWxlbWVudHNcbiAgICBpZiAoa29yZGlvbkluc3RhbmNlLmN1cnJlbnQuY2xvc2VzdCh0aGlzLnNldHRpbmdzLm5vdENsb3NlKSkge1xuICAgICAgdGhpcy50b2dnbGVLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGFjY29yZGlvbiBpcyBpbiBhIGNvbnRhaW5lciB0aGF0IGNvdmVycyBhbGwgYWNjb3JkaW9uc1xuICAgIGNvbnN0IGNvbnRhaW5lckVsZW1lbnQgPSB0aGlzLnNldHRpbmdzLmNvbnRhaW5lci5maW5kKChzZWxlY3RvcikgPT4ga29yZGlvbkluc3RhbmNlLmN1cnJlbnQuY2xvc2VzdChzZWxlY3RvcikpO1xuICAgIGlmIChjb250YWluZXJFbGVtZW50KSB7XG4gICAgICB0aGlzLmhpZGVBbGxLb3JkaW9ucyhrb3JkaW9uSW5zdGFuY2UuY3VycmVudC5jbG9zZXN0KGNvbnRhaW5lckVsZW1lbnQpKTtcbiAgICB9XG5cbiAgICAvLyBTaG93IG9yIGhpZGUgdGhlIGFjY29yZGlvblxuICAgIHRoaXMudG9nZ2xlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpO1xuICAgIHRoaXMuaGlkZU5lc3RlZEtvcmRpb25zKGVsZW1lbnQpO1xuICB9XG5cbiAgLy8gU2hvdyBhY2NvcmRpb25cbiAgc2hvd0tvcmRpb24oa29yZGlvbkluc3RhbmNlKSB7XG4gICAga29yZGlvbkluc3RhbmNlLmhpZGRlbi5zdHlsZS5oZWlnaHQgPSBgJHtrb3JkaW9uSW5zdGFuY2UuY29udGVudC5jbGllbnRIZWlnaHR9cHhgO1xuICAgIGtvcmRpb25JbnN0YW5jZS5rb3JkaW9uLmNsYXNzTGlzdC5hZGQodGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzcyk7XG5cbiAgICAvLyBTY3JvbGwgdG8gYWNjb3JkaW9uXG4gICAgaWYgKHRoaXMuc2V0dGluZ3Muc2Nyb2xsVG8pIHtcbiAgICAgIGtvcmRpb25JbnN0YW5jZS5jb250ZW50LnNjcm9sbEludG9WaWV3KHtcbiAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgIGJsb2NrOiBcInN0YXJ0XCIsXG4gICAgICAgIGlubGluZTogXCJuZWFyZXN0XCJcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2luZyB0aGUgaWNvblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5yZXBsYWNlSWNvbihrb3JkaW9uSW5zdGFuY2UsIGZhbHNlKTtcbiAgICB9LCB0aGlzLnNldHRpbmdzLnNwZWVkIC8gMik7XG4gIH1cblxuICAvLyBIaWRlIGFjY29yZGlvblxuICBoaWRlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpIHtcbiAgICBrb3JkaW9uSW5zdGFuY2UuaGlkZGVuLnN0eWxlLnJlbW92ZVByb3BlcnR5KFwiaGVpZ2h0XCIpO1xuICAgIGtvcmRpb25JbnN0YW5jZS5rb3JkaW9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzcyk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucmVwbGFjZUljb24oa29yZGlvbkluc3RhbmNlLCB0cnVlKTtcbiAgICB9LCB0aGlzLnNldHRpbmdzLnNwZWVkIC8gMik7XG4gIH1cblxuICAvLyBUb2dnbGUgYWNjb3JkaW9uXG4gIHRvZ2dsZUtvcmRpb24oa29yZGlvbkluc3RhbmNlKSB7XG4gICAgLy8gU2Nyb2xsIHRvIGFjY29yZGlvblxuICAgIGlmICgha29yZGlvbkluc3RhbmNlLmtvcmRpb24uY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuc2V0dGluZ3MuYWN0aXZlQ2xhc3MpICYmIHRoaXMuc2V0dGluZ3Muc2Nyb2xsVG8pIHtcbiAgICAgIGtvcmRpb25JbnN0YW5jZS5jb250ZW50LnNjcm9sbEludG9WaWV3KHtcbiAgICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXG4gICAgICAgIGJsb2NrOiBcInN0YXJ0XCIsXG4gICAgICAgIGlubGluZTogXCJuZWFyZXN0XCJcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGtvcmRpb25JbnN0YW5jZS5rb3JkaW9uLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzKVxuICAgICAgPyB0aGlzLmhpZGVLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSlcbiAgICAgIDogdGhpcy5zaG93S29yZGlvbihrb3JkaW9uSW5zdGFuY2UpO1xuXG4gICAgLy8gU2Nyb2xsVHJpZ2dlciBVcGRhdGUgYnkgR1NBUFxuICAgIGlmIChTY3JvbGxUcmlnZ2VyKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgU2Nyb2xsVHJpZ2dlci5yZWZyZXNoKCk7XG4gICAgICB9LCB0aGlzLnNldHRpbmdzLnNwZWVkKTtcbiAgICB9XG4gIH1cblxuICAvLyBSZXBsYWNpbmcgdGhlIGFjY29yZGlvbiBpY29uXG4gIHJlcGxhY2VJY29uKGtvcmRpb25JbnN0YW5jZSwgaGlkZGVuID0gdHJ1ZSkge1xuICAgIGlmICgha29yZGlvbkluc3RhbmNlLmtvcmRpb25JY29uKSByZXR1cm47XG4gICAgY29uc3QgdXNlVGFnID0ga29yZGlvbkluc3RhbmNlLmtvcmRpb25JY29uLnF1ZXJ5U2VsZWN0b3IoXCJ1c2VcIik7XG4gICAgaWYgKCF1c2VUYWcpIHtcbiAgICAgIGNvbnNvbGUuZGVidWcoXCJObyB1c2UgdGFnIGZvdW5kIGluIHRoZSBrb3JkaW9uIGljb25cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaWNvbiA9IGhpZGRlbiA/IGtvcmRpb25JbnN0YW5jZS5pY29uSGlkZGVuIDoga29yZGlvbkluc3RhbmNlLmljb25TaG93O1xuICAgIHVzZVRhZy5zZXRBdHRyaWJ1dGVOUyhcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiwgXCJ4bGluazpocmVmXCIsIHRoaXMuc2V0dGluZ3MuaWNvblBhdGggKyBpY29uKTtcbiAgfVxuXG4gIC8vIEhpZGUgYWxsIGFjY29yZGlvbnMgaW4gY29udGFpbmVyXG4gIGhpZGVBbGxLb3JkaW9ucyhjbG9zZXN0T2JqZWN0KSB7XG4gICAgY2xvc2VzdE9iamVjdC5xdWVyeVNlbGVjdG9yQWxsKGAke3RoaXMua29yZGlvbn0uJHt0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzfWApLmZvckVhY2goKGFjdGl2ZUtvcmRpb24pID0+IHtcbiAgICAgIGlmIChhY3RpdmVLb3JkaW9uICE9PSBldmVudC50YXJnZXQuY2xvc2VzdCh0aGlzLmtvcmRpb24pKSB7XG4gICAgICAgIGNvbnN0IGtvcmRpb25JbnN0YW5jZSA9IHRoaXMuY3JlYXRlS29yZGlvbkluc3RhbmNlKGFjdGl2ZUtvcmRpb24pO1xuICAgICAgICB0aGlzLmhpZGVLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBIaWRlIG5lc3RlZCBhY2NvcmRpb25zXG4gIGhpZGVOZXN0ZWRLb3JkaW9ucyhjb250YWluZXIpIHtcbiAgICBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCh0aGlzLmtvcmRpb24pLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IG5lc3RlZEtvcmRpb24gPSB0aGlzLmNyZWF0ZUtvcmRpb25JbnN0YW5jZShlbGVtZW50KTtcbiAgICAgIHRoaXMuaGlkZUtvcmRpb24obmVzdGVkS29yZGlvbik7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==

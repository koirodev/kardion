
/*
 * Kordion 2.0.2
 * https://github.com/koirodev/kordion
 *
 * Copyright 2024 Vitaly Koiro
 *
 * Released under the MIT License
 *
 * Released on: November 08, 2024
*/
class Kordion{constructor(t,e={}){if(!t)return void console.error("No kordion selector provided!");this.settings={content:"[data-kordion-content]",hidden:"[data-kordion-hidden]",current:"[data-kordion-current]",icon:"[data-kordion-icon]",notClose:"[data-kordion-not-close]",container:["[data-kordion-container]",".section"],activeClass:"js-kordion-active",iconClass:".icon",speed:350,iconPath:"/assets/templates/img/sprite.svg#",scrollTo:!1,...e},this.kordion=t,this.initKordions()}initKordions(){const t=document.querySelectorAll(this.kordion);t.length&&t.forEach((t=>{const e=this.createKordionInstance(t);350!=this.settings.speed&&t.style.setProperty("--kordion-speed",this.settings.speed/1e3+"s"),e.current.addEventListener("click",(()=>{this.handleKordionClick(e,t)})),t.classList.contains(this.settings.activeClass)&&e.show()}))}createKordionInstance(t){const e={kordion:t,hidden:t.querySelector(this.settings.hidden),content:t.querySelector(this.settings.content),current:t.querySelector(this.settings.current),kordionIcon:null,iconHidden:null,iconShow:null};if(e.current.querySelector(this.settings.icon)){e.kordionIcon=e.current.querySelector(this.settings.icon);let t=e.kordionIcon.getAttribute(this.settings.icon.match(/\[([^\]]+)\]/)[1]);t=t.substring(1,t.length-1);const i=t.split(",");2===i.length?(e.iconHidden=i[0].trim(),e.iconShow=i[1].trim()):console.error("Invalid data-kordion-icon attribute"),e.kordionIcon.addEventListener("click",(t=>{t.preventDefault()}))}return e}handleKordionClick(t,e){if(t.current.closest(this.settings.content)){const i=t.current.closest(this.settings.hidden);return void(e.classList.contains(this.settings.activeClass)?(this.hideKordion(t),i.style.height=i.clientHeight-t.content.clientHeight+"px"):(this.showKordion(t),i.style.height=`${i.clientHeight+t.content.clientHeight}px`))}if(t.current.closest(this.settings.notClose))return void this.toggleKordion(t);const i=this.settings.container.find((e=>t.current.closest(e)));i&&this.hideAllKordions(t.current.closest(i)),this.toggleKordion(t),this.hideNestedKordions(e)}showKordion(t){t.hidden.style.height=`${t.content.clientHeight}px`,t.kordion.classList.add(this.settings.activeClass),this.settings.scrollTo&&t.content.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),setTimeout((()=>{this.replaceIcon(t,!1)}),this.settings.speed/2)}hideKordion(t){t.hidden.style.removeProperty("height"),t.kordion.classList.remove(this.settings.activeClass),setTimeout((()=>{this.replaceIcon(t,!0)}),this.settings.speed/2)}toggleKordion(t){!t.kordion.classList.contains(this.settings.activeClass)&&this.settings.scrollTo&&t.content.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),t.kordion.classList.contains(this.settings.activeClass)?this.hideKordion(t):this.showKordion(t),ScrollTrigger&&setTimeout((()=>{ScrollTrigger.refresh()}),this.settings.speed)}replaceIcon(t,e=!0){if(!t.kordionIcon)return;const i=t.kordionIcon.querySelector("use");if(!i)return void console.debug("No use tag found in the kordion icon");const o=e?t.iconHidden:t.iconShow;i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.settings.iconPath+o)}hideAllKordions(t){t.querySelectorAll(`${this.kordion}.${this.settings.activeClass}`).forEach((t=>{if(t!==event.target.closest(this.kordion)){const e=this.createKordionInstance(t);this.hideKordion(e)}}))}hideNestedKordions(t){t.querySelectorAll(this.kordion).forEach((t=>{const e=this.createKordionInstance(t);this.hideKordion(e)}))}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIktvcmRpb24iLCJjb25zdHJ1Y3RvciIsImtvcmRpb24iLCJvcHRpb25zIiwiY29uc29sZSIsImVycm9yIiwidGhpcyIsInNldHRpbmdzIiwiY29udGVudCIsImhpZGRlbiIsImN1cnJlbnQiLCJpY29uIiwibm90Q2xvc2UiLCJjb250YWluZXIiLCJhY3RpdmVDbGFzcyIsImljb25DbGFzcyIsInNwZWVkIiwiaWNvblBhdGgiLCJzY3JvbGxUbyIsImluaXRLb3JkaW9ucyIsImtvcmRpb25zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibGVuZ3RoIiwiZm9yRWFjaCIsImVsZW1lbnQiLCJrb3JkaW9uSW5zdGFuY2UiLCJjcmVhdGVLb3JkaW9uSW5zdGFuY2UiLCJzdHlsZSIsInNldFByb3BlcnR5IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUtvcmRpb25DbGljayIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwic2hvdyIsInF1ZXJ5U2VsZWN0b3IiLCJrb3JkaW9uSWNvbiIsImljb25IaWRkZW4iLCJpY29uU2hvdyIsImljb25MaXN0IiwiZ2V0QXR0cmlidXRlIiwibWF0Y2giLCJzdWJzdHJpbmciLCJpY29uQXJyYXkiLCJzcGxpdCIsInRyaW0iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiY2xvc2VzdCIsInBhcmVudENvbnRlbnQiLCJoaWRlS29yZGlvbiIsImhlaWdodCIsImNsaWVudEhlaWdodCIsInNob3dLb3JkaW9uIiwidG9nZ2xlS29yZGlvbiIsImNvbnRhaW5lckVsZW1lbnQiLCJmaW5kIiwic2VsZWN0b3IiLCJoaWRlQWxsS29yZGlvbnMiLCJoaWRlTmVzdGVkS29yZGlvbnMiLCJhZGQiLCJzY3JvbGxJbnRvVmlldyIsImJlaGF2aW9yIiwiYmxvY2siLCJpbmxpbmUiLCJzZXRUaW1lb3V0IiwicmVwbGFjZUljb24iLCJyZW1vdmVQcm9wZXJ0eSIsInJlbW92ZSIsIlNjcm9sbFRyaWdnZXIiLCJyZWZyZXNoIiwidXNlVGFnIiwiZGVidWciLCJzZXRBdHRyaWJ1dGVOUyIsImNsb3Nlc3RPYmplY3QiLCJhY3RpdmVLb3JkaW9uIiwidGFyZ2V0IiwibmVzdGVkS29yZGlvbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBQUEsUUFDQSxXQUFBQyxDQUFBQyxFQUFBQyxFQUFBLENBQUEsR0FDQSxJQUFBRCxFQUVBLFlBREFFLFFBQUFDLE1BQUEsaUNBbUJBQyxLQUFBQyxTQUFBLENBYkFDLFFBQUEseUJBQ0FDLE9BQUEsd0JBQ0FDLFFBQUEseUJBQ0FDLEtBQUEsc0JBQ0FDLFNBQUEsMkJBQ0FDLFVBQUEsQ0FBQSwyQkFBQSxZQUNBQyxZQUFBLG9CQUNBQyxVQUFBLFFBQ0FDLE1BQUEsSUFDQUMsU0FBQSxvQ0FDQUMsVUFBQSxLQUdBZixHQUNBRyxLQUFBSixRQUFBQSxFQUdBSSxLQUFBYSxjQUNBLENBRUEsWUFBQUEsR0FDQSxNQUFBQyxFQUFBQyxTQUFBQyxpQkFBQWhCLEtBQUFKLFNBQ0FrQixFQUFBRyxRQUVBSCxFQUFBSSxTQUFBQyxJQUNBLE1BQUFDLEVBQUFwQixLQUFBcUIsc0JBQUFGLEdBRUEsS0FBQW5CLEtBQUFDLFNBQUFTLE9BQ0FTLEVBQUFHLE1BQUFDLFlBQUEsa0JBQUF2QixLQUFBQyxTQUFBUyxNQUFBLElBQUEsS0FHQVUsRUFBQWhCLFFBQUFvQixpQkFBQSxTQUFBLEtBQ0F4QixLQUFBeUIsbUJBQUFMLEVBQUFELEVBQUEsSUFHQUEsRUFBQU8sVUFBQUMsU0FBQTNCLEtBQUFDLFNBQUFPLGNBQ0FZLEVBQUFRLE1BQ0EsR0FFQSxDQUdBLHFCQUFBUCxDQUFBRixHQUNBLE1BQUFDLEVBQUEsQ0FDQXhCLFFBQUF1QixFQUNBaEIsT0FBQWdCLEVBQUFVLGNBQUE3QixLQUFBQyxTQUFBRSxRQUNBRCxRQUFBaUIsRUFBQVUsY0FBQTdCLEtBQUFDLFNBQUFDLFNBQ0FFLFFBQUFlLEVBQUFVLGNBQUE3QixLQUFBQyxTQUFBRyxTQUNBMEIsWUFBQSxLQUNBQyxXQUFBLEtBQ0FDLFNBQUEsTUFJ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QSxZQURBbkUsUUFBQW9FLE1BQUEsd0NBSUEsTUFBQTdELEVBQUFGLEVBQUFpQixFQUFBVyxXQUFBWCxFQUFBWSxTQUNBaUMsRUFBQUUsZUFBQSwrQkFBQSxhQUFBbkUsS0FBQUMsU0FBQVUsU0FBQU4sRUFDQSxDQUdBLGVBQUErQyxDQUFBZ0IsR0FDQUEsRUFBQXBELGlCQUFBLEdBQUFoQixLQUFBSixXQUFBSSxLQUFBQyxTQUFBTyxlQUFBVSxTQUFBbUQsSUFDQSxHQUFBQSxJQUFBN0IsTUFBQThCLE9BQUE1QixRQUFBMUMsS0FBQUosU0FBQSxDQUNBLE1BQUF3QixFQUFBcEIsS0FBQXFCLHNCQUFBZ0QsR0FDQXJFLEtBQUE0QyxZQUFBeEIsRUFDQSxJQUVBLENBR0Esa0JBQUFpQyxDQUFBOUMsR0FDQUEsRUFBQVMsaUJBQUFoQixLQUFBSixTQUFBc0IsU0FBQUMsSUFDQSxNQUFBb0QsRUFBQXZFLEtBQUFxQixzQkFBQUYsR0FDQW5CLEtBQUE0QyxZQUFBMkIsRUFBQSxHQUVBIiwiZmlsZSI6ImtvcmRpb24ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgS29yZGlvbiB7XG4gIGNvbnN0cnVjdG9yKGtvcmRpb24sIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICgha29yZGlvbikge1xuICAgICAgY29uc29sZS5lcnJvcihcIk5vIGtvcmRpb24gc2VsZWN0b3IgcHJvdmlkZWQhXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgYWNjb3JkaW9uIHNldHRpbmdzXG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICBjb250ZW50OiBcIltkYXRhLWtvcmRpb24tY29udGVudF1cIixcbiAgICAgIGhpZGRlbjogXCJbZGF0YS1rb3JkaW9uLWhpZGRlbl1cIixcbiAgICAgIGN1cnJlbnQ6IFwiW2RhdGEta29yZGlvbi1jdXJyZW50XVwiLFxuICAgICAgaWNvbjogXCJbZGF0YS1rb3JkaW9uLWljb25dXCIsXG4gICAgICBub3RDbG9zZTogXCJbZGF0YS1rb3JkaW9uLW5vdC1jbG9zZV1cIixcbiAgICAgIGNvbnRhaW5lcjogW1wiW2RhdGEta29yZGlvbi1jb250YWluZXJdXCIsIFwiLnNlY3Rpb25cIl0sXG4gICAgICBhY3RpdmVDbGFzczogXCJqcy1rb3JkaW9uLWFjdGl2ZVwiLFxuICAgICAgaWNvbkNsYXNzOiBcIi5pY29uXCIsXG4gICAgICBzcGVlZDogMzUwLFxuICAgICAgaWNvblBhdGg6IFwiL2Fzc2V0cy90ZW1wbGF0ZXMvaW1nL3Nwcml0ZS5zdmcjXCIsXG4gICAgICBzY3JvbGxUbzogZmFsc2UsXG4gICAgfTtcblxuICAgIHRoaXMuc2V0dGluZ3MgPSB7IC4uLmRlZmF1bHRPcHRpb25zLCAuLi5vcHRpb25zIH07XG4gICAgdGhpcy5rb3JkaW9uID0ga29yZGlvbjtcblxuICAgIC8vIEluaXRpYWxpemluZyBBY2NvcmRpb25zXG4gICAgdGhpcy5pbml0S29yZGlvbnMoKTtcbiAgfVxuXG4gIGluaXRLb3JkaW9ucygpIHtcbiAgICBjb25zdCBrb3JkaW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5rb3JkaW9uKTtcbiAgICBpZiAoIWtvcmRpb25zLmxlbmd0aCkgcmV0dXJuO1xuXG4gICAga29yZGlvbnMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgY29uc3Qga29yZGlvbkluc3RhbmNlID0gdGhpcy5jcmVhdGVLb3JkaW9uSW5zdGFuY2UoZWxlbWVudCk7XG5cbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLnNwZWVkICE9IDM1MCkge1xuICAgICAgICBlbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KFwiLS1rb3JkaW9uLXNwZWVkXCIsIGAke3RoaXMuc2V0dGluZ3Muc3BlZWQgLyAxMDAwfXNgKTtcbiAgICAgIH1cblxuICAgICAga29yZGlvbkluc3RhbmNlLmN1cnJlbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVLb3JkaW9uQ2xpY2soa29yZGlvbkluc3RhbmNlLCBlbGVtZW50KTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnModGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzcykpIHtcbiAgICAgICAga29yZGlvbkluc3RhbmNlLnNob3coKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIENyZWF0aW5nIGFuIEFjY29yZGlvbiBJbnN0YW5jZVxuICBjcmVhdGVLb3JkaW9uSW5zdGFuY2UoZWxlbWVudCkge1xuICAgIGNvbnN0IGtvcmRpb25JbnN0YW5jZSA9IHtcbiAgICAgIGtvcmRpb246IGVsZW1lbnQsXG4gICAgICBoaWRkZW46IGVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLmhpZGRlbiksXG4gICAgICBjb250ZW50OiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zZXR0aW5ncy5jb250ZW50KSxcbiAgICAgIGN1cnJlbnQ6IGVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLmN1cnJlbnQpLFxuICAgICAga29yZGlvbkljb246IG51bGwsXG4gICAgICBpY29uSGlkZGVuOiBudWxsLFxuICAgICAgaWNvblNob3c6IG51bGxcbiAgICB9O1xuXG4gICAgLy8gU2V0dGluZyB1cCB0aGUgaWNvbiBpZiBwcmVzZW50XG4gICAgaWYgKGtvcmRpb25JbnN0YW5jZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zZXR0aW5ncy5pY29uKSkge1xuICAgICAga29yZGlvbkluc3RhbmNlLmtvcmRpb25JY29uID0ga29yZGlvbkluc3RhbmNlLmN1cnJlbnQucXVlcnlTZWxlY3Rvcih0aGlzLnNldHRpbmdzLmljb24pO1xuICAgICAgbGV0IGljb25MaXN0ID0ga29yZGlvbkluc3RhbmNlLmtvcmRpb25JY29uLmdldEF0dHJpYnV0ZSh0aGlzLnNldHRpbmdzLmljb24ubWF0Y2goL1xcWyhbXlxcXV0rKVxcXS8pWzFdKTtcbiAgICAgIGljb25MaXN0ID0gaWNvbkxpc3Quc3Vic3RyaW5nKDEsIGljb25MaXN0Lmxlbmd0aCAtIDEpO1xuICAgICAgY29uc3QgaWNvbkFycmF5ID0gaWNvbkxpc3Quc3BsaXQoXCIsXCIpO1xuICAgICAgaWYgKGljb25BcnJheS5sZW5ndGggPT09IDIpIHtcbiAgICAgICAga29yZGlvbkluc3RhbmNlLmljb25IaWRkZW4gPSBpY29uQXJyYXlbMF0udHJpbSgpO1xuICAgICAgICBrb3JkaW9uSW5zdGFuY2UuaWNvblNob3cgPSBpY29uQXJyYXlbMV0udHJpbSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgZGF0YS1rb3JkaW9uLWljb24gYXR0cmlidXRlXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBDYW5jZWwgZGVmYXVsdCBhY3Rpb24gd2hlbiBjbGlja2luZyBvbiBpY29uXG4gICAgICBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbkljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBrb3JkaW9uSW5zdGFuY2U7XG4gIH1cblxuICAvLyBIYW5kbGluZyBhIGNsaWNrIG9uIGFuIGFjY29yZGlvblxuICBoYW5kbGVLb3JkaW9uQ2xpY2soa29yZGlvbkluc3RhbmNlLCBlbGVtZW50KSB7XG4gICAgaWYgKGtvcmRpb25JbnN0YW5jZS5jdXJyZW50LmNsb3Nlc3QodGhpcy5zZXR0aW5ncy5jb250ZW50KSkge1xuICAgICAgY29uc3QgcGFyZW50Q29udGVudCA9IGtvcmRpb25JbnN0YW5jZS5jdXJyZW50LmNsb3Nlc3QodGhpcy5zZXR0aW5ncy5oaWRkZW4pO1xuICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKHRoaXMuc2V0dGluZ3MuYWN0aXZlQ2xhc3MpKSB7XG4gICAgICAgIHRoaXMuaGlkZUtvcmRpb24oa29yZGlvbkluc3RhbmNlKTtcbiAgICAgICAgcGFyZW50Q29udGVudC5zdHlsZS5oZWlnaHQgPSBgJHtwYXJlbnRDb250ZW50LmNsaWVudEhlaWdodCAtIGtvcmRpb25JbnN0YW5jZS5jb250ZW50LmNsaWVudEhlaWdodH1weGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNob3dLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSk7XG4gICAgICAgIHBhcmVudENvbnRlbnQuc3R5bGUuaGVpZ2h0ID0gYCR7cGFyZW50Q29udGVudC5jbGllbnRIZWlnaHQgKyBrb3JkaW9uSW5zdGFuY2UuY29udGVudC5jbGllbnRIZWlnaHR9cHhgO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSBhY2NvcmRpb24gZG9lcyBub3QgY2xvc2Ugd2hlbiBjbGlja2luZyBvbiBjZXJ0YWluIGVsZW1lbnRzXG4gICAgaWYgKGtvcmRpb25JbnN0YW5jZS5jdXJyZW50LmNsb3Nlc3QodGhpcy5zZXR0aW5ncy5ub3RDbG9zZSkpIHtcbiAgICAgIHRoaXMudG9nZ2xlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSBhY2NvcmRpb24gaXMgaW4gYSBjb250YWluZXIgdGhhdCBjb3ZlcnMgYWxsIGFjY29yZGlvbnNcbiAgICBjb25zdCBjb250YWluZXJFbGVtZW50ID0gdGhpcy5zZXR0aW5ncy5jb250YWluZXIuZmluZCgoc2VsZWN0b3IpID0+IGtvcmRpb25JbnN0YW5jZS5jdXJyZW50LmNsb3Nlc3Qoc2VsZWN0b3IpKTtcbiAgICBpZiAoY29udGFpbmVyRWxlbWVudCkge1xuICAgICAgdGhpcy5oaWRlQWxsS29yZGlvbnMoa29yZGlvbkluc3RhbmNlLmN1cnJlbnQuY2xvc2VzdChjb250YWluZXJFbGVtZW50KSk7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBvciBoaWRlIHRoZSBhY2NvcmRpb25cbiAgICB0aGlzLnRvZ2dsZUtvcmRpb24oa29yZGlvbkluc3RhbmNlKTtcbiAgICB0aGlzLmhpZGVOZXN0ZWRLb3JkaW9ucyhlbGVtZW50KTtcbiAgfVxuXG4gIC8vIFNob3cgYWNjb3JkaW9uXG4gIHNob3dLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSkge1xuICAgIGtvcmRpb25JbnN0YW5jZS5oaWRkZW4uc3R5bGUuaGVpZ2h0ID0gYCR7a29yZGlvbkluc3RhbmNlLmNvbnRlbnQuY2xpZW50SGVpZ2h0fXB4YDtcbiAgICBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbi5jbGFzc0xpc3QuYWRkKHRoaXMuc2V0dGluZ3MuYWN0aXZlQ2xhc3MpO1xuXG4gICAgLy8gU2Nyb2xsIHRvIGFjY29yZGlvblxuICAgIGlmICh0aGlzLnNldHRpbmdzLnNjcm9sbFRvKSB7XG4gICAgICBrb3JkaW9uSW5zdGFuY2UuY29udGVudC5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgIGJlaGF2aW9yOiBcInNtb290aFwiLFxuICAgICAgICBibG9jazogXCJzdGFydFwiLFxuICAgICAgICBpbmxpbmU6IFwibmVhcmVzdFwiXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZXBsYWNpbmcgdGhlIGljb25cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMucmVwbGFjZUljb24oa29yZGlvbkluc3RhbmNlLCBmYWxzZSk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy5zcGVlZCAvIDIpO1xuICB9XG5cbiAgLy8gSGlkZSBhY2NvcmRpb25cbiAgaGlkZUtvcmRpb24oa29yZGlvbkluc3RhbmNlKSB7XG4gICAga29yZGlvbkluc3RhbmNlLmhpZGRlbi5zdHlsZS5yZW1vdmVQcm9wZXJ0eShcImhlaWdodFwiKTtcbiAgICBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuc2V0dGluZ3MuYWN0aXZlQ2xhc3MpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLnJlcGxhY2VJY29uKGtvcmRpb25JbnN0YW5jZSwgdHJ1ZSk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy5zcGVlZCAvIDIpO1xuICB9XG5cbiAgLy8gVG9nZ2xlIGFjY29yZGlvblxuICB0b2dnbGVLb3JkaW9uKGtvcmRpb25JbnN0YW5jZSkge1xuICAgIC8vIFNjcm9sbCB0byBhY2NvcmRpb25cbiAgICBpZiAoIWtvcmRpb25JbnN0YW5jZS5rb3JkaW9uLmNsYXNzTGlzdC5jb250YWlucyh0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzKSAmJiB0aGlzLnNldHRpbmdzLnNjcm9sbFRvKSB7XG4gICAgICBrb3JkaW9uSW5zdGFuY2UuY29udGVudC5zY3JvbGxJbnRvVmlldyh7XG4gICAgICAgIGJlaGF2aW9yOiBcInNtb290aFwiLFxuICAgICAgICBibG9jazogXCJzdGFydFwiLFxuICAgICAgICBpbmxpbmU6IFwibmVhcmVzdFwiXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBrb3JkaW9uSW5zdGFuY2Uua29yZGlvbi5jbGFzc0xpc3QuY29udGFpbnModGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzcylcbiAgICAgID8gdGhpcy5oaWRlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpXG4gICAgICA6IHRoaXMuc2hvd0tvcmRpb24oa29yZGlvbkluc3RhbmNlKTtcblxuICAgIC8vIFNjcm9sbFRyaWdnZXIgVXBkYXRlIGJ5IEdTQVBcbiAgICBpZiAoU2Nyb2xsVHJpZ2dlcikge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIFNjcm9sbFRyaWdnZXIucmVmcmVzaCgpO1xuICAgICAgfSwgdGhpcy5zZXR0aW5ncy5zcGVlZCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUmVwbGFjaW5nIHRoZSBhY2NvcmRpb24gaWNvblxuICByZXBsYWNlSWNvbihrb3JkaW9uSW5zdGFuY2UsIGhpZGRlbiA9IHRydWUpIHtcbiAgICBpZiAoIWtvcmRpb25JbnN0YW5jZS5rb3JkaW9uSWNvbikgcmV0dXJuO1xuICAgIGNvbnN0IHVzZVRhZyA9IGtvcmRpb25JbnN0YW5jZS5rb3JkaW9uSWNvbi5xdWVyeVNlbGVjdG9yKFwidXNlXCIpO1xuICAgIGlmICghdXNlVGFnKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKFwiTm8gdXNlIHRhZyBmb3VuZCBpbiB0aGUga29yZGlvbiBpY29uXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGljb24gPSBoaWRkZW4gPyBrb3JkaW9uSW5zdGFuY2UuaWNvbkhpZGRlbiA6IGtvcmRpb25JbnN0YW5jZS5pY29uU2hvdztcbiAgICB1c2VUYWcuc2V0QXR0cmlidXRlTlMoXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCIsIFwieGxpbms6aHJlZlwiLCB0aGlzLnNldHRpbmdzLmljb25QYXRoICsgaWNvbik7XG4gIH1cblxuICAvLyBIaWRlIGFsbCBhY2NvcmRpb25zIGluIGNvbnRhaW5lclxuICBoaWRlQWxsS29yZGlvbnMoY2xvc2VzdE9iamVjdCkge1xuICAgIGNsb3Nlc3RPYmplY3QucXVlcnlTZWxlY3RvckFsbChgJHt0aGlzLmtvcmRpb259LiR7dGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzc31gKS5mb3JFYWNoKChhY3RpdmVLb3JkaW9uKSA9PiB7XG4gICAgICBpZiAoYWN0aXZlS29yZGlvbiAhPT0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QodGhpcy5rb3JkaW9uKSkge1xuICAgICAgICBjb25zdCBrb3JkaW9uSW5zdGFuY2UgPSB0aGlzLmNyZWF0ZUtvcmRpb25JbnN0YW5jZShhY3RpdmVLb3JkaW9uKTtcbiAgICAgICAgdGhpcy5oaWRlS29yZGlvbihrb3JkaW9uSW5zdGFuY2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gSGlkZSBuZXN0ZWQgYWNjb3JkaW9uc1xuICBoaWRlTmVzdGVkS29yZGlvbnMoY29udGFpbmVyKSB7XG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5rb3JkaW9uKS5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICBjb25zdCBuZXN0ZWRLb3JkaW9uID0gdGhpcy5jcmVhdGVLb3JkaW9uSW5zdGFuY2UoZWxlbWVudCk7XG4gICAgICB0aGlzLmhpZGVLb3JkaW9uKG5lc3RlZEtvcmRpb24pO1xuICAgIH0pO1xuICB9XG59XG4iXX0=
